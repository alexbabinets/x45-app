<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>X45 ‚Äî Meals (AI)</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0a0b0d; --panel:#0f1116; --panel2:#0e0f13; --divider:#1a1c22;
  --ink:#e7ecf3; --muted:#9aa3ad; --ring:rgba(128,173,214,.22);
  --btn:#263244; --btnH:#2d3a51;

  --nav-dashboard:#4c2a3a; --nav-dashboard-hover:#5f3348;
  --nav-tests:#2a3a4c; --nav-tests-hover:#33485f;
  --nav-workouts:#2b3f38; --nav-workouts-hover:#355046;
  --nav-meals:#4a3a2a; --nav-meals-hover:#5a4734;
  --nav-settings:#3b314d; --nav-settings-hover:#4a3d63;
  --nav-ink:#e8eef7; --nav-ink-dim:#d7e3f2;

  --c-kcal:#ef4444; --c-pro:#22c55e; --c-carb:#3b82f6; --c-fat:#f59e0b;

  --cta-strong:#f59e0b; --cta-strong-ink:#0a0b0d;
}

*{box-sizing:border-box;}

html,body{
  margin:0;
  padding:0;
  background:var(--bg);
  color:var(--ink);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
}

.page{
  max-width:1160px;
  margin:18px auto 130px;
  padding:0 14px;
  display:flex;
  flex-direction:column;
  gap:14px;
}

/* Brand / topbar */

.brand{
  display:flex;
  justify-content:center;
  margin-top:6px;
}

.brand img{
  height:60px;
  filter:drop-shadow(0 8px 28px rgba(0,0,0,.45));
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.hello{
  color:var(--muted);
  font-weight:900;
  font-size:14px;
}

/* Coach header */

.coach{
  display:flex;
  gap:14px;
  align-items:center;
  background:linear-gradient(180deg,#12121b,#0e0e15);
  padding:16px;
  border-radius:18px;
  border:1px solid var(--divider);
}

.coach-left{
  display:flex;
  gap:14px;
  align-items:center;
  width:100%;
}

.coach-portrait{
  width:78px;
  height:94px;
  border-radius:12px;
  overflow:hidden;
  flex:0 0 78px;
  background:#0c0e12;
  border:1px solid var(--divider);
  box-shadow:0 0 0 6px var(--ring);
  cursor:pointer;
  transition:transform .12s ease,box-shadow .12s ease;
}

.coach-portrait:hover{
  transform:translateY(-1px);
  box-shadow:0 0 0 8px rgba(102,187,255,.36);
}

.coach-portrait img{
  width:100%;
  height:100%;
  object-fit:cover;
  object-position:center top;
  display:block;
}

.coach-text{
  display:flex;
  flex-direction:column;
  gap:8px;
  min-width:0;
}

.coach h1{
  margin:0 0 2px;
  font-size:20px;
}

.coach p{
  margin:0;
  color:#cbd5e1;
  font-size:14px;
  line-height:1.45;
}

.cta{
  align-self:flex-start;
  display:inline-flex;
  gap:8px;
  align-items:center;
  font-weight:800;
  font-size:13px;
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--divider);
  background:#0f1116;
  color:#dbe9ff;
  cursor:pointer;
  transition:box-shadow .15s ease, transform .05s ease, background .15s ease;
}

.cta:hover{
  box-shadow:0 0 0 6px rgba(102,187,255,.18);
}

.cta:active{
  transform:translateY(1px);
}

.cta.primary{
  background:var(--btn);
  border-color:transparent;
  color:#fff;
}

.cta.primary:hover{
  background:var(--btnH);
}

.cta.small{
  padding:6px 10px;
  font-size:11px;
}

/* Cards */

.card{
  background:var(--panel);
  border:1px solid var(--divider);
  border-radius:16px;
  padding:16px;
}

.card h2{
  margin:0 0 8px;
  font-size:18px;
}

.sub{
  font-size:12px;
  color:var(--muted);
}

/* Layout helpers */

.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}

select.input,
input[type="text"].input{
  appearance:none;
  background:#0f1319;
  color:#e7ecf3;
  border:1px solid #29313b;
  border-radius:10px;
  padding:10px 12px;
  font-size:14px;
  min-width:190px;
}

/* Goal/support card */

#goalSupport{
  position:relative;
}

#dietLine{
  font-size:14px;
  font-weight:800;
  letter-spacing:.2px;
}

#dietLine .dietValue{
  font-weight:900;
  font-size:15px;
  text-transform:capitalize;
}

/* Pills */

.pills{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.pill{
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  border:1px solid rgba(255,255,255,.08);
  display:inline-flex;
  gap:6px;
  align-items:center;
}

.pill.kcal{
  background:rgba(239,68,68,.14);
  border-color:rgba(239,68,68,.35);
  color:#ffdfe0;
}
.pill.pro{
  background:rgba(34,197,94,.18);
  border-color:rgba(34,197,94,.35);
  color:#dbffe8;
}
.pill.carb{
  background:rgba(59,130,246,.18);
  border-color:rgba(59,130,246,.35);
  color:#dff0ff;
}
.pill.fat{
  background:rgba(245,158,11,.18);
  border-color:rgba(245,158,11,.35);
  color:#fff1d9;
}

/* Today section */

.todayGrid{
  display:grid;
  grid-template-columns:320px 1fr;
  gap:16px;
}

.donutWrap{
  display:flex;
  align-items:center;
  justify-content:center;
}

.donut{
  position:relative;
  width:240px;
  height:240px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
}

.donut canvas{
  width:240px;
  height:240px;
}

.donut .center{
  position:absolute;
  text-align:center;
  font-weight:900;
  font-size:26px;
}

.donut .center small{
  display:block;
  font-weight:800;
  font-size:12px;
  color:#cbd5e1;
}

/* Sliders */

.slRow{
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:10px;
  align-items:center;
}

.slider,
.mealSlider,
.portionSlider{
  appearance:none;
  width:100%;
  height:10px;
  border-radius:999px;
  background:#0d1218;
  border:1px solid #1f2631;
  outline:none;
}

.slider::-webkit-slider-thumb,
.mealSlider::-webkit-slider-thumb,
.portionSlider::-webkit-slider-thumb{
  appearance:none;
  width:18px;
  height:18px;
  border-radius:50%;
  background:#e6eef9;
  border:2px solid #284060;
  cursor:pointer;
}

.slider::-moz-range-thumb,
.mealSlider::-moz-range-thumb,
.portionSlider::-moz-range-thumb{
  width:18px;
  height:18px;
  border-radius:50%;
  background:#e6eef9;
  border:2px solid #284060;
  cursor:pointer;
}

.slider.pro,
.mealSlider.pro{
  background:linear-gradient(90deg, rgba(34,197,94,.28), rgba(34,197,94,.10));
  border-color:rgba(34,197,94,.35);
}
.slider.carb,
.mealSlider.carb{
  background:linear-gradient(90deg, rgba(59,130,246,.28), rgba(59,130,246,.10));
  border-color:rgba(59,130,246,.35);
}
.slider.fat,
.mealSlider.fat{
  background:linear-gradient(90deg, rgba(245,158,11,.30), rgba(245,158,11,.10));
  border-color:rgba(245,158,11,.38);
}

/* Meals */

.meal{
  border:1px solid #263245;
  background:linear-gradient(180deg,#10141b,#0e1016);
  border-radius:16px;
  padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.meal+.meal{ margin-top:10px; }

.mealHead{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

.mealName{
  font-weight:900;
  font-size:16px;
}

.mealBadge{
  background:#151b24;
  border:1px solid #2b3443;
  color:#cfe0ff;
  padding:6px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:11px;
}

.mealGrid{
  display:grid;
  grid-template-columns:130px 1fr;
  gap:14px;
  align-items:center;
  margin-top:10px;
}

.mealDonut{
  position:relative;
  width:120px;
  height:120px;
  border-radius:12px;
  background:#0c1015;
  border:1px solid #1b2330;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:6px;
}

.mealDonut canvas{
  width:108px;
  height:108px;
}

.mealDonut .center{
  position:absolute;
  text-align:center;
  font-weight:900;
  font-size:14px;
}

.mealDonut .center small{
  display:block;
  font-weight:600;
  color:#9aa3ad;
  margin-top:2px;
  font-size:11px;
}

.mealMacros{
  display:grid;
  grid-template-columns:auto 1fr auto;
  gap:8px 10px;
  align-items:center;
}

.mealLabel{
  color:#cbd5e1;
  font-size:12px;
}

.portionRow{
  display:flex;
  align-items:center;
  gap:8px;
  margin-top:8px;
}

.portionList{
  margin:8px 0 0;
  padding-left:18px;
  color:#e7ecf3;
  font-size:12px;
}
.portionList li{
  margin:3px 0;
}
.portionList em{
  color:#9aa3ad;
  font-style:normal;
}

/* Footer nav */

.footer{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:min(740px,94%);
  display:grid;
  grid-template-columns:repeat(5,1fr);
  gap:8px;
  background:rgba(15,16,20,.92);
  backdrop-filter:blur(10px);
  border:1px solid var(--divider);
  border-radius:14px;
  padding:8px;
  z-index:50;
}

.footer a,
.footer span.nav-disabled{
  --bg:#12141a;
  --bgH:#1a1e26;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:10px;
  border-radius:12px;
  background:var(--bg);
  border:1px solid rgba(255,255,255,.08);
  color:var(--nav-ink);
  font-weight:900;
  font-size:13px;
  text-decoration:none;
  letter-spacing:.2px;
  transition:transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease, color .12s ease;
  box-shadow:0 1px 0 rgba(0,0,0,.35) inset;
}

.footer a:nth-child(1){ --bg:var(--nav-dashboard); --bgH:var(--nav-dashboard-hover); color:#ffe6ef; }
.footer a:nth-child(2){ --bg:var(--nav-tests); --bgH:var(--nav-tests-hover); color:var(--nav-ink-dim); }
.footer a:nth-child(3){ --bg:var(--nav-workouts); --bgH:var(--nav-workouts-hover); color:#e9fff3; }
.footer a:nth-child(4){ --bg:var(--nav-meals); --bgH:var(--nav-meals-hover); color:#b6aba0; }
.footer a:nth-child(5){ --bg:var(--nav-settings); --bgH:var(--nav-settings-hover); color:#efe9ff; }

.footer a:hover{
  transform:translateY(-1px);
  background:var(--bgH);
  border-color:rgba(255,255,255,.14);
  box-shadow:0 6px 16px rgba(0,0,0,.35), 0 0 0 2px rgba(255,255,255,.05) inset;
}

/* ===== Mobile tweaks ===== */

@media (max-width: 800px){
  .page{
    margin-top:10px;
    padding-inline:10px;
    margin-bottom:120px;
  }
  .coach{
    padding:12px;
  }
  .coach-portrait{
    width:64px;
    height:80px;
  }
  .coach h1{
    font-size:17px;
  }
  .topbar .hello{
    font-size:13px;
  }
  .todayGrid{
    grid-template-columns:1fr;
  }
  .donut{
    width:190px;
    height:190px;
  }
  .donut canvas{
    width:190px;
    height:190px;
  }
  .mealGrid{
    grid-template-columns:1fr;
  }
}

@media (max-width: 540px){
  .footer{
    padding:6px;
    gap:6px;
  }
  .footer a{
    padding:8px 4px;
    font-size:11px;
  }
  .hello{
    font-size:12px;
  }
  .pill{
    font-size:11px;
  }
}
</style>
</head>

<body>
<div class="page">
  <!-- Brand -->
  <div class="brand">
    <img src="https://expressfitness.ca/wp-content/uploads/2025/06/X45-LOGO-CUT-OUT-TM.png" alt="X45"/>
  </div>

  <div class="topbar">
    <div class="hello" id="hello">Good morning, friend ‚Äî let‚Äôs dial in your meals.</div>
  </div>

  <!-- Coach Header -->
  <section class="coach">
    <div class="coach-left">
      <div class="coach-portrait" id="coachPortrait">
        <img id="coachImg" src="https://expressfitness.ca/wp-content/uploads/2025/04/zara.png" alt="Coach Zara">
      </div>
      <div class="coach-text">
        <h1 id="coachTitle">Your coach is here.</h1>
        <p id="coachLine" class="sub">‚ÄúFuel smart, train strong. I‚Äôll shape meals around your day.‚Äù</p>
        <button id="coachChat" class="cta" type="button">üí¨ Chat with Coach</button>
      </div>
    </div>
  </section>

  <!-- Goal & Support -->
  <section class="card" id="goalSupport">
    <h2>Goal & Support</h2>
    <div class="row" style="margin-top:6px">
      <label class="sub" style="min-width:60px">Goal</label>
      <select id="goalSelect" class="input">
        <option value="lose">Weight Loss</option>
        <option value="maintain">Maintain</option>
        <option value="gain">Build Muscle</option>
        <option value="performance" selected>Performance</option>
      </select>
    </div>
    <div class="row" style="margin-top:10px">
      <label class="sub" style="min-width:60px">Support</label>
      <select id="supportSelect" class="input">
        <option value="simple" selected>Simple Daily Plan</option>
        <option value="detailed">Detailed Macro Plan</option>
      </select>
    </div>
    <div class="row" style="margin-top:12px">
      <div class="sub" id="dietLine">
        Diet: <span class="dietValue">balanced</span> ‚Ä¢ Allergies: ‚Äî ‚Ä¢ Likes: ‚Äî ‚Ä¢ Dislikes: ‚Äî
      </div>
    </div>
  </section>

  <!-- Today overview -->
  <section class="card">
    <h2>Today</h2>
    <div class="sub" id="todayMeta">
      Total: ‚Äî kcal ‚Ä¢ Protein ‚Äî g ‚Ä¢ Carbs ‚Äî g ‚Ä¢ Fat ‚Äî g
    </div>

    <div class="pills" style="margin:8px 0 8px">
      <span class="pill kcal" id="pCal">Calories: ‚Äî</span>
      <span class="pill pro" id="pPro">Protein: ‚Äî g</span>
      <span class="pill carb" id="pCarb">Carbs: ‚Äî g</span>
      <span class="pill fat" id="pFat">Fat: ‚Äî g</span>
    </div>

    <div class="todayGrid" style="margin-top:6px">
      <div class="donutWrap">
        <div class="donut">
          <canvas id="todayDonut"></canvas>
          <div class="center">
            <span id="calsCenter">‚Äî</span>
            <small>kcal</small>
          </div>
        </div>
      </div>

      <div>
        <div class="row sub" style="margin-bottom:6px">
          <span style="display:inline-flex;align-items:center;gap:6px">
            <span style="width:12px;height:12px;background:var(--c-pro);display:inline-block;border-radius:3px"></span>
            Protein ‚Äî <b id="pctPro">40</b>%
          </span>
          <span style="display:inline-flex;align-items:center;gap:6px">
            <span style="width:12px;height:12px;background:var(--c-carb);display:inline-block;border-radius:3px"></span>
            Carbs ‚Äî <b id="pctCarb">40</b>%
          </span>
          <span style="display:inline-flex;align-items:center;gap:6px">
            <span style="width:12px;height:12px;background:var(--c-fat);display:inline-block;border-radius:3px"></span>
            Fat ‚Äî <b id="pctFat">20</b>%
          </span>
        </div>

        <!-- Top macro sliders -->
        <div class="slRow">
          <span class="sub">Protein</span>
          <input id="slPro" type="range" min="0" max="100" value="40" class="slider pro">
          <span id="lblPro" class="sub">40%</span>
        </div>
        <div class="slRow">
          <span class="sub">Carbs</span>
          <input id="slCarb" type="range" min="0" max="100" value="40" class="slider carb">
          <span id="lblCarb" class="sub">40%</span>
        </div>
        <div class="slRow">
          <span class="sub">Fat</span>
          <input id="slFat" type="range" min="0" max="100" value="20" class="slider fat">
          <span id="lblFat" class="sub">20%</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Meals -->
  <section class="card">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
      <h2>Meals & Portions</h2>
      <span class="mealBadge" id="totalsBadge">Total: ‚Äî kcal ‚Ä¢ P ‚Äî g ‚Ä¢ C ‚Äî g ‚Ä¢ F ‚Äî g</span>
    </div>
    <div id="meals" style="margin-top:8px"></div>
  </section>
</div>

<!-- Footer nav (Meals current page) -->
<nav class="footer" aria-label="navigation">
  <a href="step8-dashboard-login.html">Dashboard</a>
  <a href="tests.html">Tests</a>
  <a href="lets-workout-now.html">Workouts</a>
  <span class="nav-disabled">Meals</span>
  <a href="settings.html">Settings</a>
</nav>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const $ = s => document.querySelector(s);
  const $$ = s => document.querySelectorAll(s);
  const cssVar = k => getComputedStyle(document.documentElement).getPropertyValue(k).trim();

  /* ===== State ===== */
  const state = {
    goal: 'performance',
    kcal: 2600,
    split: { p:40, c:40, f:20 }, // %
    meals: [
      { key:'breakfast', title:'Breakfast Bowl', share:0.25, portion:1 },
      { key:'lunch',     title:'Lunch Plate',    share:0.35, portion:1 },
      { key:'snack',     title:'Snack',          share:0.10, portion:1 },
      { key:'dinner',    title:'Dinner Plate',   share:0.30, portion:1 }
    ]
  };

  /* ===== Helpers ===== */

  function normalizeSplit(p,c,f){
    let s = p + c + f;
    if (s <= 0) return {p:40,c:40,f:20};
    const k = 100 / s;
    p = Math.round(p * k);
    c = Math.round(c * k);
    f = Math.max(0, 100 - p - c);
    return {p,c,f};
  }

  function macroGrams(totalKcal, split){
    const pK = totalKcal * split.p / 100;
    const cK = totalKcal * split.c / 100;
    const fK = totalKcal * split.f / 100;
    return {
      kcal: Math.round(totalKcal),
      p: Math.round(pK / 4),
      c: Math.round(cK / 4),
      f: Math.round(fK / 9)
    };
  }

  function drawDonut(canvas, p, c, f){
    if (!canvas) return;
    const dpr = Math.min(1.5, window.devicePixelRatio || 1);
    const rect = canvas.getBoundingClientRect();
    if (!rect.width || !rect.height) return;

    canvas.width  = Math.round(rect.width * dpr);
    canvas.height = Math.round(rect.height * dpr);
    const ctx = canvas.getContext('2d');
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const W = rect.width;
    const H = rect.height;
    const cx = W/2;
    const cy = H/2;
    const radius = Math.min(W,H)*0.38;
    const thickness = Math.max(12, radius*0.45);

    const total = Math.max(1, p + c + f);
    const k = 2 * Math.PI / total;
    let angle = -Math.PI/2;

    ctx.clearRect(0,0,W,H);

    // background ring
    ctx.beginPath();
    ctx.arc(cx,cy,radius,0,2*Math.PI);
    ctx.lineWidth = thickness;
    ctx.strokeStyle = '#0b0f14';
    ctx.stroke();

    function seg(value, color){
      const end = angle + value * k;
      ctx.beginPath();
      ctx.arc(cx,cy,radius,angle,end);
      ctx.strokeStyle = color;
      ctx.lineWidth = thickness;
      ctx.lineCap = 'round';
      ctx.stroke();
      angle = end;
    }

    seg(p, cssVar('--c-pro') || '#22c55e');
    seg(c, cssVar('--c-carb') || '#3b82f6');
    seg(f, cssVar('--c-fat') || '#f59e0b');
  }

  /* ===== Rendering ===== */

  function renderDay(){
    const grams = macroGrams(state.kcal, state.split);

    $('#calsCenter').textContent = grams.kcal.toLocaleString();
    $('#pCal').textContent  = `Calories: ${grams.kcal.toLocaleString()}`;
    $('#pPro').textContent  = `Protein: ${grams.p} g`;
    $('#pCarb').textContent = `Carbs: ${grams.c} g`;
    $('#pFat').textContent  = `Fat: ${grams.f} g`;

    $('#todayMeta').textContent =
      `Total: ${grams.kcal.toLocaleString()} kcal ‚Ä¢ Protein ${grams.p} g ‚Ä¢ Carbs ${grams.c} g ‚Ä¢ Fat ${grams.f} g`;

    $('#pctPro').textContent = state.split.p;
    $('#pctCarb').textContent = state.split.c;
    $('#pctFat').textContent  = state.split.f;

    $('#lblPro').textContent  = state.split.p + '%';
    $('#lblCarb').textContent = state.split.c + '%';
    $('#lblFat').textContent  = state.split.f + '%';

    $('#slPro').value  = state.split.p;
    $('#slCarb').value = state.split.c;
    $('#slFat').value  = state.split.f;

    requestAnimationFrame(() => drawDonut($('#todayDonut'),
      state.split.p, state.split.c, state.split.f));

    // update meals macros based on current split & portions
    let totalKcal = 0, totalP = 0, totalC = 0, totalF = 0;

    state.meals.forEach((m, i) => {
      const base = state.kcal * m.share;
      const kcal = base * m.portion;
      const g = macroGrams(kcal, state.split);

      const mealBox = $(`[data-meal="${m.key}"]`);
      if (!mealBox) return;

      totalKcal += g.kcal;
      totalP += g.p;
      totalC += g.c;
      totalF += g.f;

      mealBox.querySelector('.mealBadge').textContent =
        `~ ${g.kcal.toFixed(0)} kcal`;
      mealBox.querySelector('.pill.kcal').textContent =
        `~ ${g.kcal.toFixed(0)} kcal`;
      mealBox.querySelector('.pill.pro').textContent =
        `P ${g.p} g`;
      mealBox.querySelector('.pill.carb').textContent =
        `C ${g.c} g`;
      mealBox.querySelector('.pill.fat').textContent =
        `F ${g.f} g`;

      mealBox.querySelector('.portionValue').textContent =
        m.portion.toFixed(1) + '√ó';

      const pSpan = mealBox.querySelector('.mpct');
      const cSpan = mealBox.querySelector('.mcct');
      const fSpan = mealBox.querySelector('.mfct');
      if (pSpan) pSpan.textContent = state.split.p;
      if (cSpan) cSpan.textContent = state.split.c;
      if (fSpan) fSpan.textContent = state.split.f;

      const donut = mealBox.querySelector('canvas');
      requestAnimationFrame(() => drawDonut(donut,
        state.split.p, state.split.c, state.split.f));
    });

    $('#totalsBadge').textContent =
      `Total: ${Math.round(totalKcal).toLocaleString()} kcal ‚Ä¢ P ${totalP} g ‚Ä¢ C ${totalC} g ‚Ä¢ F ${totalF} g`;
  }

  function renderMeals(){
    const wrap = $('#meals');
    wrap.innerHTML = '';

    state.meals.forEach(m => {
      const div = document.createElement('div');
      div.className = 'meal';
      div.dataset.meal = m.key;

      div.innerHTML = `
        <div class="mealHead">
          <div class="mealName">${m.title}</div>
          <span class="mealBadge">~ ‚Äî kcal</span>
        </div>
        <div class="mealGrid">
          <div class="mealDonut">
            <canvas></canvas>
            <div class="center">
              <span class="mealKcal">‚Äî</span>
              <small>kcal</small>
            </div>
          </div>
          <div>
            <div class="pills" style="margin-bottom:8px">
              <span class="pill kcal">~ ‚Äî kcal</span>
              <span class="pill pro">P ‚Äî g</span>
              <span class="pill carb">C ‚Äî g</span>
              <span class="pill fat">F ‚Äî g</span>
            </div>

            <div class="mealMacros">
              <span class="mealLabel">Protein</span>
              <input type="range" min="0" max="100" value="${state.split.p}"
                     class="mealSlider pro" data-meal="${m.key}" data-type="p">
              <span class="mealLabel"><b class="mpct">${state.split.p}</b>%</span>

              <span class="mealLabel">Carbs</span>
              <input type="range" min="0" max="100" value="${state.split.c}"
                     class="mealSlider carb" data-meal="${m.key}" data-type="c">
              <span class="mealLabel"><b class="mcct">${state.split.c}</b>%</span>

              <span class="mealLabel">Fat</span>
              <input type="range" min="0" max="100" value="${state.split.f}"
                     class="mealSlider fat" data-meal="${m.key}" data-type="f">
              <span class="mealLabel"><b class="mfct">${state.split.f}</b>%</span>
            </div>

            <div class="portionRow">
              <span class="sub">Portion</span>
              <input type="range" min="0.5" max="2" step="0.1"
                     class="portionSlider" data-meal="${m.key}" value="${m.portion}">
              <span class="sub"><b class="portionValue">${m.portion.toFixed(1)}√ó</b></span>
            </div>

            <ul class="portionList">
              <li><strong>Main plate</strong> ‚Äî auto-balanced to your macros <em>(x <span class="portionValue">${m.portion.toFixed(1)}√ó</span>)</em></li>
            </ul>
          </div>
        </div>
      `;
      wrap.appendChild(div);
    });

    renderDay();
  }

  /* ===== Events ===== */

  // Top macro sliders
  $('#slPro').addEventListener('input', () => {
    const p = Number($('#slPro').value);
    const c = Number($('#slCarb').value);
    const f = Number($('#slFat').value);
    state.split = normalizeSplit(p,c,f);
    renderDay();
  });

  $('#slCarb').addEventListener('input', () => {
    const p = Number($('#slPro').value);
    const c = Number($('#slCarb').value);
    const f = Number($('#slFat').value);
    state.split = normalizeSplit(p,c,f);
    renderDay();
  });

  $('#slFat').addEventListener('input', () => {
    const p = Number($('#slPro').value);
    const c = Number($('#slCarb').value);
    const f = Number($('#slFat').value);
    state.split = normalizeSplit(p,c,f);
    renderDay();
  });

  // Per‚Äìmeal sliders (reuse global split; they just "feel" local)
  $('#meals').addEventListener('input', (e) => {
    const t = e.target;
    if (t.classList.contains('mealSlider')) {
      const p = Number($$('#slPro')[0].value);
      const c = Number($$('#slCarb')[0].value);
      const f = Number($$('#slFat')[0].value);

      const type = t.dataset.type;
      let np = state.split.p;
      let nc = state.split.c;
      let nf = state.split.f;

      const val = Number(t.value);

      if (type === 'p') np = val;
      if (type === 'c') nc = val;
      if (type === 'f') nf = val;

      state.split = normalizeSplit(np,nc,nf);

      $('#slPro').value  = state.split.p;
      $('#slCarb').value = state.split.c;
      $('#slFat').value  = state.split.f;

      renderDay();
    }

    if (t.classList.contains('portionSlider')) {
      const key = t.dataset.meal;
      const m = state.meals.find(x => x.key === key);
      if (!m) return;
      m.portion = parseFloat(t.value) || 1;
      const mealBox = document.querySelector(`.meal[data-meal="${key}"]`);
      if (mealBox) {
        mealBox.querySelectorAll('.portionValue').forEach(sp => {
          sp.textContent = m.portion.toFixed(1) + '√ó';
        });
      }
      renderDay();
    }
  });

  // Goal select adjusts total kcal a bit
  $('#goalSelect').addEventListener('change', () => {
    const val = $('#goalSelect').value;
    state.goal = val;
    if (val === 'lose')      state.kcal = 1900;
    else if (val === 'maintain') state.kcal = 2300;
    else if (val === 'gain') state.kcal = 2900;
    else                     state.kcal = 2600;
    renderDay();
  });

  // Dummy support select ‚Äî for now just text
  $('#supportSelect').addEventListener('change', () => {
    const mode = $('#supportSelect').value;
    const dietLine = $('#dietLine');
    if (mode === 'simple') {
      dietLine.innerHTML =
        'Diet: <span class="dietValue">balanced</span> ‚Ä¢ Allergies: ‚Äî ‚Ä¢ Likes: ‚Äî ‚Ä¢ Dislikes: ‚Äî';
    } else {
      dietLine.innerHTML =
        'Diet: <span class="dietValue">detailed macros</span> ‚Ä¢ Allergies: ‚Äî ‚Ä¢ Likes: ‚Äî ‚Ä¢ Dislikes: ‚Äî';
    }
  });

  // Coach click ‚Üí placeholder navigation
  $('#coachChat').addEventListener('click', () => {
    // hook to your chat coach page later
    alert('Chat with coach will live here in the app build.');
  });
  $('#coachPortrait').addEventListener('click', () => {
    $('#coachChat').click();
  });

  /* ===== Init ===== */

  function initGreeting(){
    const h = new Date().getHours();
    const part = h < 12 ? 'Good morning' : (h < 18 ? 'Good afternoon' : 'Good evening');
    $('#hello').textContent = `${part}, friend ‚Äî let‚Äôs dial in your meals.`;
  }

  renderMeals();
  initGreeting();
});
</script>
</body>
</html>
