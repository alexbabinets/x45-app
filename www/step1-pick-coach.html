<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>X45 – Pick Your Coach</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    .container { max-width: 900px; margin: auto; padding: 40px 20px; }
    img.logo { width: 180px; margin-bottom: 20px; }

    #welcome-back { font-size: 36px; font-weight: bold; margin-bottom: 10px; color: #fff; }
    #welcome-sub  { font-size: 20px; font-weight: normal; margin-bottom: 10px; color: #fff; }
    #step-label   { font-size: 24px; font-weight: bold; margin-top: 20px; margin-bottom: 30px; color: #00b3ff; text-decoration: underline; }

    .coach-group {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 30px;
      margin-bottom: 30px;
    }

    label { cursor: pointer; }

    .coach-card{
      width: 240px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 16px 14px 14px;
      transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease, background .15s ease;
    }
    .coach-card:hover{
      transform: translateY(-3px);
      border-color: rgba(0,179,255,0.55);
      box-shadow: 0 0 0 2px rgba(0,179,255,0.12);
      background: rgba(0,179,255,0.04);
    }

    label img { width: 170px; border-radius: 12px; margin: 6px 0 10px; }

    .coach-title{
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 18px;
      font-weight: bold;
      margin-top: 4px;
      margin-bottom: 8px;
      color: #fff;
    }

    input[type="radio"] { transform: scale(1.3); margin-right: 6px; accent-color: #00b3ff; }

    .coach-desc{
      font-size: 14.5px;
      line-height: 1.45;
      color: #cfd6df;
      text-align: left;
      margin: 0 auto;
      padding: 0 6px;
    }
    .coach-desc strong{
      color:#fff;
      font-weight: bold;
    }

    button {
      background-color: #e60023;
      color: white;
      padding: 14px 30px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: background .15s ease, transform .05s ease;
    }
    button:hover { background-color: #ff1a1a; }
    button:active{ transform: translateY(1px); }

    @media (max-width: 600px){
      #welcome-back{ font-size: 30px; }
      #welcome-sub{ font-size: 18px; }
      #step-label{ font-size: 20px; }
      .coach-card{ width: 100%; max-width: 320px; }
      label img{ width: 180px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://expressfitness.ca/wp-content/uploads/2025/06/X45-LOGO-CUT-OUT-TM.png"
         class="logo" alt="X45 Logo" />
    
    <div id="welcome-back">Welcome back.</div>
    <div id="welcome-sub">Let’s get excited and create your X45 program.</div>
    <div id="step-label">Step 1. Choose your coach.</div>

    <form id="coach-form">
      <div class="coach-group">

        <!-- ZARA -->
        <label>
          <div class="coach-card">
            <img src="https://expressfitness.ca/wp-content/uploads/2025/04/zara.png" alt="Coach Zara" />
            <div class="coach-title">
              <input type="radio" name="coach" value="Zara" />
              <span>Coach Zara</span>
            </div>
            <p class="coach-desc">
              <strong>Specialty:</strong> Helps you break through mental blocks, overcome self-doubt, and build the emotional strength required for a truly lasting transformation in your body and mind.<br><br>
              <strong>Style:</strong> Warm, intuitive, energetic, and deeply supportive — she inspires growth with honesty and heart, making you feel understood, empowered, and ready to rise.
            </p>
          </div>
        </label>

        <!-- STEPHANIE -->
        <label>
          <div class="coach-card">
            <img src="https://expressfitness.ca/wp-content/uploads/2025/04/step.png" alt="Coach Stephanie" />
            <div class="coach-title">
              <input type="radio" name="coach" value="Stephanie" />
              <span>Coach Stephanie</span>
            </div>
            <p class="coach-desc">
              <strong>Specialty:</strong> Helps you rebuild self-esteem, reclaim your inner power, and stay consistent with your fitness and nutrition habits so progress becomes natural and unstoppable.<br><br>
              <strong>Style:</strong> Fun, feisty, and full of genuine encouragement — she motivates like a loyal best friend who lifts your spirit and never lets you fall behind your goals.
            </p>
          </div>
        </label>

        <!-- MAX -->
        <label>
          <div class="coach-card">
            <img src="https://expressfitness.ca/wp-content/uploads/2025/04/MAX-NEW-1.png" alt="Coach Max" />
            <div class="coach-title">
              <input type="radio" name="coach" value="Max" />
              <span>Coach Max</span>
            </div>
            <p class="coach-desc">
              <strong>Specialty:</strong> Helps you remove excuses, develop discipline, and create structure so you can transform your body and mindset with clarity, strength, and long-term direction.<br><br>
              <strong>Style:</strong> Bold, direct, and fearless — he pushes you with intensity and care, guiding you to become the strongest, most resilient version of yourself.
            </p>
          </div>
        </label>

      </div>

      <button type="submit">Continue</button>
    </form>
  </div>

  <script>
    const SUPABASE_URL = 'https://ajoimwcrmszhmcjrpxjv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqb2ltd2NybXN6aG1janJweGp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5NzYxNzYsImV4cCI6MjA2NzU1MjE3Nn0.4R5iVqe_JKuXZLrGkhBtTFdlHj3xuq99-UhfNbMzWeM';
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const SIGNIN_URL = 'https://expressfitness.ca/x45-app/signin.html';
    const NEXT_PAGE  = 'https://expressfitness.ca/x45-app/step2-fitness-level.html';

    async function loadUser() {
      const { data: { user }, error } = await client.auth.getUser();
      if (error || !user) {
        // если не залогинен — отправляем на sign in
        window.location.href = SIGNIN_URL;
        return;
      }

      const { data, error: fetchError } = await client
        .from('x45_users')
        .select('first_name')
        .eq('id', user.id)
        .single();

      if (!fetchError && data && data.first_name) {
        document.getElementById("welcome-back").textContent = `Welcome back, ${data.first_name}.`;
      }
    }

    document.addEventListener("DOMContentLoaded", loadUser);

    document.getElementById("coach-form").addEventListener("submit", async function(event) {
      event.preventDefault();

      const coach = document.querySelector('input[name="coach"]:checked');
      if (!coach) {
        alert("Please select a coach.");
        return;
      }

      const coachName = coach.value;

      try {
        const { data: { user }, error: userError } = await client.auth.getUser();
        if (!user || userError) {
          window.location.href = SIGNIN_URL;
          return;
        }

        const { error } = await client
          .from('x45_users')
          .update({ coach: coachName })
          .eq('id', user.id);

        if (error) {
          alert("Database error: " + error.message);
          return;
        }

        const coachEncoded = encodeURIComponent(coachName);
        const nameText = document.getElementById("welcome-back").textContent;
        let name = "Member";
        if (nameText.includes(",")) {
          name = nameText.split(",")[1].replace(".", "").trim();
        }
        const nameEncoded = encodeURIComponent(name);

        window.location.href = `${NEXT_PAGE}?coach=${coachEncoded}&name=${nameEncoded}`;
      } catch (err) {
        alert("Unexpected error: " + err.message);
      }
    });
  </script>
</body>
</html>
