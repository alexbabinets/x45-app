<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up ‚Äì X45</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    :root { --bg:#000; --card:#111; --field:#222; --muted:#bbb; --error:#ff4d4d; --red:#e30000; }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:#fff; font-family:Arial,Helvetica,sans-serif;
         display:flex; align-items:center; justify-content:center}
    .wrap{width:min(92%,420px); text-align:center}
    .logo{max-width:160px; display:block; margin:0 auto 18px}
    h1{font-size:36px; margin:0 0 6px}
    .subtitle{font-size:16px; color:#cfcfcf; margin-bottom:18px}
    .label{ text-align:left; color:var(--muted); font-size:14px; margin:8px 0 4px}
    .field{position:relative; margin:6px 0}
    input[type="text"],input[type="email"],input[type="password"],input[type="date"]{
      width:100%; box-sizing:border-box; background:#222; color:#fff;
      border:0; border-radius:10px; padding:14px 44px 14px 14px; font-size:16px;
    }
    input::placeholder{color:#9a9a9a}
    .eye{position:absolute; right:12px; top:50%; transform:translateY(-50%); cursor:pointer; color:#aaa}
    .dob-row{display:flex; gap:10px}
    .gender{display:flex; justify-content:center; gap:34px; background:#1b1b1b; padding:12px; border-radius:10px}
    .error{color:var(--error); text-align:left; min-height:18px; font-size:14px}
    .btn{margin-top:16px; width:100%; border:0; border-radius:12px; padding:16px 18px; background:var(--red);
         color:#fff; font-weight:700; font-size:18px; cursor:pointer; box-shadow:0 14px 34px rgba(227,0,0,.35)}
    .row-link{margin-top:10px; font-size:14px; color:#cfcfcf}
    .row-link a{color:#e6e6e6}
  </style>
</head>
<body>
  <div class="wrap">
    <img class="logo" alt="X45" src="https://expressfitness.ca/wp-content/uploads/2025/06/X45-LOGO-CUT-OUT-TM.png">
    <h1>Create Your Account</h1>
    <div class="subtitle">Let‚Äôs get you started</div>

    <form id="signupForm" onsubmit="event.preventDefault(); register();">
      <div class="field"><input id="firstName" type="text" placeholder="First name" autocomplete="given-name"></div>
      <div class="field"><input id="lastName" type="text" placeholder="Last name (Optional)" autocomplete="family-name"></div>

      <div class="label">Date of Birth</div>
      <div class="field"><input id="dob" type="date"></div>
      <div id="dobError" class="error"></div>

      <div class="label">Gender</div>
      <div class="gender">
        <label><input type="radio" name="gender" value="male"> Male</label>
        <label><input type="radio" name="gender" value="female"> Female</label>
      </div>
      <div id="genderError" class="error"></div>

      <div class="field"><input id="email" type="email" placeholder="Email address" autocomplete="email"></div>
      <div class="field"><input id="confirmEmail" type="email" placeholder="Confirm email address" autocomplete="off"></div>
      <div id="emailError" class="error"></div>

      <div class="field">
        <input id="password" type="password" placeholder="Create password" autocomplete="new-password">
        <span class="eye" onclick="toggle('password',this)">üëÅÔ∏è</span>
      </div>

      <div class="field">
        <input id="confirmPassword" type="password" placeholder="Confirm password" autocomplete="new-password">
        <span class="eye" onclick="toggle('confirmPassword',this)">üëÅÔ∏è</span>
      </div>
      <div id="passwordError" class="error"></div>

      <button class="btn" type="submit">Start My Free Trial</button>
    </form>

    <div class="row-link">Already have an account? <a href="signin.html">Sign in</a></div>
  </div>

  <script>
    const BASE_URL = 'https://expressfitness.ca/x45';
    const SUPABASE_URL = 'https://ajoimwcrmszhmcjrpxjv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqb2ltd2NybXN6aG1janJweGp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5NzYxNzYsImV4cCI6MjA2NzU1MjE3Nn0.4R5iVqe_JKuXZLrGkhBtTFdlHj3xuq99-UhfNbMzWeM';
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // DOB limits
    (function () {
      const dob = document.getElementById('dob');
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth()+1).padStart(2,'0');
      const dd = String(now.getDate()).padStart(2,'0');
      dob.max = `${yyyy}-${mm}-${dd}`;
      dob.min = '1900-01-01';
    })();

    function toggle(id, el){
      const i = document.getElementById(id);
      i.type = (i.type === 'password') ? 'text' : 'password';
      el.style.color = (i.type === 'text') ? '#fff' : '#aaa';
    }
    function g(){ const r=document.querySelector('input[name="gender"]:checked'); return r?r.value:'';}
    function dobErr(v){
      if(!v) return "Please select your date of birth.";
      const d=new Date(v), n=new Date();
      if(d>n) return "DOB cannot be in the future.";
      const age=n.getFullYear()-d.getFullYear() - ((n.getMonth()<d.getMonth() || (n.getMonth()==d.getMonth() && n.getDate()<d.getDate()))?1:0);
      if(age<13) return "You must be at least 13 years old.";
      return "";
    }

    async function register(){
      const firstName = document.getElementById('firstName').value.trim();
      const lastName  = document.getElementById('lastName').value.trim();
      const email     = document.getElementById('email').value.trim();
      const confirmEmail = document.getElementById('confirmEmail').value.trim();
      const password  = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const dob       = document.getElementById('dob').value;
      const gender    = g();

      document.getElementById('emailError').textContent='';
      document.getElementById('passwordError').textContent='';
      document.getElementById('dobError').textContent='';
      document.getElementById('genderError').textContent='';

      if(!firstName){ alert("Please enter your first name."); return; }
      if(email !== confirmEmail){ document.getElementById('emailError').textContent="Emails do not match."; return; }
      if(password !== confirmPassword){ document.getElementById('passwordError').textContent="Passwords do not match."; return; }

      const dErr = dobErr(dob); if(dErr){ document.getElementById('dobError').textContent=dErr; return; }
      if(!gender){ document.getElementById('genderError').textContent="Please select gender."; return; }

      try{
        const { error } = await client.auth.signUp({
          email,
          password,
          options: {
            emailRedirectTo: `${BASE_URL}/signin.html`,
            data: { first_name:firstName, last_name:lastName, dob, gender }
          }
        });
        if(error){ alert('Supabase Error: '+error.message); return; }
        // Success ‚Äì show ‚ÄúAccount Created‚Äù message
        location.href = `accountcreated.html?email=${encodeURIComponent(email)}`;
      }catch(e){ alert('Unexpected error: '+e.message); }
    }
  </script>
</body>
</html>
